let u=[],i=0;const a=4;let r=o=>{let l=[],e={get(){return e.lc||e.listen(()=>{})(),e.value},lc:0,listen(t){return e.lc=l.push(t),()=>{for(let f=i+a;f<u.length;)u[f]===t?u.splice(f,a):f+=a;let n=l.indexOf(t);~n&&(l.splice(n,1),--e.lc||e.off())}},notify(t,n){let f=!u.length;for(let s of l)u.push(s,e.value,t,n);if(f){for(i=0;i<u.length;i+=a)u[i](u[i+1],u[i+2],u[i+3]);u.length=0}},off(){},set(t){let n=e.value;n!==t&&(e.value=t,e.notify(n))},subscribe(t){let n=e.listen(t);return t(e.value),n},value:o};return e},v=(o={})=>{let l=r(o);return l.setKey=function(e,t){let n=l.value;typeof t>"u"&&e in l.value?(l.value={...l.value},delete l.value[e],l.notify(n,e)):l.value[e]!==t&&(l.value={...l.value,[e]:t},l.notify(n,e))},l};export{r as a,v as m};
