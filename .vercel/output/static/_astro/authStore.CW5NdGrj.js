import{w as s}from"./index.Bj88MMzq.js";import{s as n}from"./supabase.CIJy6KaJ.js";const o=s(!1),r=s(null),t=s(!0),l=s(null);async function f(){try{t.set(!0),console.log("initAuth: Verificando sesión con Supabase...");const{data:e}=await n.auth.getSession();e.session?console.log("initAuth: Sesión activa encontrada"):console.log("initAuth: No hay sesión activa"),i(e.session);const{data:{subscription:u}}=n.auth.onAuthStateChange((c,a)=>{console.log("Auth state changed:",c,a?"Con sesión":"Sin sesión"),i(a)});return typeof window<"u"&&window.addEventListener("beforeunload",()=>{u.unsubscribe()}),{success:!0}}catch(e){return console.error("Error al inicializar autenticación:",e),l.set(e.message),{success:!1,error:e}}finally{t.set(!1)}}function i(e){console.log("Actualizando stores de auth:",e?"Autenticado":"No autenticado"),e?(o.set(!0),r.set(e.user),typeof window<"u"&&localStorage.setItem("authStatus","authenticated")):(o.set(!1),r.set(null),typeof window<"u"&&localStorage.removeItem("authStatus"))}async function g(){try{t.set(!0);const{error:e}=await n.auth.signOut();if(e)throw e;return{success:!0}}catch(e){return console.error("Error al cerrar sesión:",e),{success:!1,error:e.message}}finally{t.set(!1)}}typeof window<"u"&&f();export{o as i,g as l};
