import{b as i,c as d,p as f}from"./client.schema.D9gTZs88.js";import{m as y,a as l}from"./index.9eZ28vGx.js";const o=y({}),p=l(0),E=l(0),s=l(null),u="jamuche-cart";function w(r,t=1){try{const a=o.get()[r.id]?.quantity||0,n=f(r,a+t);return o.setKey(r.id,n),c(),s.set(null),!0}catch(e){return console.error("Error al añadir al carrito:",e),s.set(e.message||"Error al añadir producto al carrito"),!1}}function v(r,t){try{const a=o.get()[r];if(!a)throw new Error("Producto no encontrado en el carrito");if(t>0){const n={...a,quantity:t,total:d({...a,quantity:t})},m=i(n);o.setKey(r,m)}else g(r);return c(),s.set(null),!0}catch(e){return console.error("Error al actualizar cantidad:",e),s.set(e.message||"Error al actualizar cantidad"),!1}}function g(r){try{const e=o.get()[r];if(!e)throw new Error("Producto no encontrado en el carrito");if(e.quantity>1){const a={...e,quantity:e.quantity-1,total:d({...e,quantity:e.quantity-1})},n=i(a);o.setKey(r,n)}else o.setKey(r,void 0);return c(),s.set(null),!0}catch(t){return console.error("Error al eliminar del carrito:",t),s.set(t.message||"Error al eliminar del carrito"),!1}}function K(r){try{return o.setKey(r,void 0),c(),s.set(null),!0}catch(t){return console.error("Error al eliminar completamente:",t),s.set(t.message||"Error al eliminar completamente"),!1}}function c(){const r=o.get();let t=0,e=0;Object.values(r).forEach(a=>{if(a){t+=a.quantity;const n=a.discountprice>0?a.discountprice:a.price;e+=n*a.quantity}}),p.set(t),E.set(e)}function C(){if(!(typeof window>"u"))try{const r=localStorage.getItem(u);if(r){const t=JSON.parse(r);t&&typeof t=="object"&&(Object.entries(t).forEach(([e,a])=>{if(a)try{const n=i(a);o.setKey(e,n)}catch(n){console.warn(`Item inválido en carrito guardado (ID: ${e}):`,n)}}),c())}o.listen(t=>{typeof window<"u"&&localStorage.setItem(u,JSON.stringify(t))})}catch(r){console.error("Error al inicializar carrito:",r),o.set({}),c()}}typeof window<"u"&&C();export{E as a,s as b,o as c,K as d,w as e,p as f,g as r,v as u};
