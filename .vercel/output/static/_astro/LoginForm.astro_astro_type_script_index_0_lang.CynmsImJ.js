import{i as f}from"./authStore.oNKChDb7.js";import{t as p,s as E}from"./supabase.CIJy6KaJ.js";import"./index.Bj88MMzq.js";import"./equality.Dp7T0ObN.js";let g=0;const b=3;document.addEventListener("DOMContentLoaded",()=>{const u=document.getElementById("login-form");document.getElementById("error-message-text");const d=document.getElementById("login-button"),c=document.getElementById("login-text"),l=document.getElementById("login-spinner"),h=!1;function v(){localStorage.setItem("devModeAuth","true"),localStorage.setItem("jamuchee_admin_auth","true"),localStorage.setItem("authStatus","authenticated"),f.set(!0),window.location.pathname.includes("/dashboard")||(window.location.href="/admin/dashboard")}u&&d&&c&&l&&u.addEventListener("submit",async m=>{if(m.preventDefault(),g++,g>b){r("Demasiados intentos de inicio de sesión. Por favor, recarga la página.");return}const e=document.getElementById("email"),i=document.getElementById("password");if(!e||!i){r("Por favor, complete todos los campos");return}const t=e.value||"",o=i.value||"";c.classList.add("hidden"),l.classList.remove("hidden"),d.disabled=!0;try{if(!(await p()).success){r("No se pudo conectar a la base de datos. Verifica tu conexión a internet.");return}const{data:s,error:a}=await E.auth.signInWithPassword({email:t,password:o});if(a)throw a;s.user?(f.set(!0),localStorage.setItem("jamuchee_admin_auth","true"),localStorage.setItem("authStatus","authenticated"),window.location.href="/admin/dashboard"):r("No se pudo iniciar sesión. Datos de usuario no disponibles.")}catch(n){let s="Error desconocido";if(n instanceof Error)s=n.message;else if(typeof n=="object"&&n!==null&&"message"in n){const a=n.message;a.includes("Invalid login credentials")?s="Credenciales incorrectas":a.includes("Failed to fetch")?s="Error de conexión. Verifica tu internet.":s=a}r("Error: "+s)}finally{c.classList.remove("hidden"),l.classList.add("hidden"),d.disabled=!1}});function r(m){const e=document.getElementById("error-message-text");if(e){e.textContent=m;const i=e.closest(".bg-red-100");if(i)i.classList.remove("hidden");else{const t=document.createElement("div");t.className="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-4",t.setAttribute("role","alert"),t.appendChild(e);const o=document.getElementById("login-form");o&&o.parentNode&&o.parentNode.insertBefore(t,o)}}}});
